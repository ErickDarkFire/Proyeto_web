<!doctype html>
<html lang="en">
    <head>
        <title>Title</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="Timer.css">
    </head>

    <body>
        <div id="contenedor_carga">
                <div id="carga"></div>
        </div>
        <header>
            <div class="timer" id="Timer">
                <b id="txtseg">20</b>
                <div><p>Segundos</p></div>
            </div>
        </header>
        <main>
            <div class="barra" id="barra">
                <span class="progreso" id="progress"></span>
            </div>
            <div class="center">
                <button class="btn bg-dark text-light border border-2" id="TimerStart">Time</button>
            </div>
            <script>
                let seg = 20;
                let progressPercent = 0;
                let stepPercent = 0.1;
                let progressBarID = null;
                let CountDownID = null;
                function TimesUp(){
                    let txtseg;
                    seg--;
                    document.getElementById('txtseg').innerHTML = seg < 10 ? '0' + seg : seg;
                    if(seg <= 0){
                        alert('Se acabo el tiempo!');
                        seg = 0;
                        clearInterval(CountDownID);
                        return;
                    }
                }
                function IncreaseBar(){
                    let bar = document.getElementById('progress');
                    if (progressPercent >= 100) {
                        bar.style.width = "100%";
                        alert("Barra completada en el seg: " + seg);
                        clearInterval(progressBarID);
                        return;
                    }
                    progressPercent += stepPercent;
                    bar.style.width = progressPercent + "%";
                }

                /*function SetTimer(){
                    seg = 20;
                    if( CountDownID == null) CountDownID = setInterval(TimesUp ,1010);
                    else{
                        document.getElementById('txtseg').innerHTML = '20';
                        clearInterval(CountDownID);
                        CountDownID = setInterval(TimesUp ,1010);
                    }
                    //calculamos cuantas veces se tiene que ejecutar en 1 seg
                    let totalDuration = 20000; // 30 segundos
                    stepPercent = 0.1; // aumenta 0.1% por paso
                    progressPercent = 0;
                    let steps = 100 / stepPercent; // 1000 pasos en total
                    let intervalTime = totalDuration / steps; // tiempo entre pasos (20ms)
                    if( progressBarID == null) progressBarID = setInterval(IncreaseBar, intervalTime);
                    else{
                        clearInterval(progressBarID);
                        progressBarID = setInterval(IncreaseBar, intervalTime);
                    }
                }
                
                let Button = document.getElementById("TimerStart");
                Button.addEventListener('click', SetTimer);*/

                async function obtenerRespuestaDeChatGPT() {
                    // Simulamos una espera como si se estuviera llamando a la API
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve("Respuesta de ChatGPT lista!");
                            let contenedor = document.getElementById('contenedor_carga');
                            contenedor.style.visibility = 'hidden';
                            contenedor.style.opacity = '0';
                            CountDownID = setInterval(TimesUp ,1010);
                            //calculamos cuantas veces se tiene que ejecutar en 1 seg
                            let totalDuration = 20000; // 30 segundos
                            stepPercent = 0.1; // aumenta 0.1% por paso
                            progressPercent = 0;
                            let steps = 100 / stepPercent; // 1000 pasos en total
                            let intervalTime = totalDuration / steps; // tiempo entre pasos (20ms)
                            progressBarID = setInterval(IncreaseBar, intervalTime);
                        }, 10000); // Espera 3 segundos
                    });
                }
                obtenerRespuestaDeChatGPT();
            </script>
        </main>
        <footer>
        </footer>
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
